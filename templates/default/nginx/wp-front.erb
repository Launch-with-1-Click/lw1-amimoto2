    set $do_not_cache 0;
    if ($http_cookie ~* "comment_author_|wordpress_(?!test_cookie)|wp-postpass_" ) {
        set $do_not_cache 1;
    }
    if ($request_method = POST) {
        set $do_not_cache 1;
    }

    set $proxy_https '';
    set $proxy_proto $scheme;
    if ( $http_x_forwarded_proto = 'https' ) {
        set $proxy_https 'on';
        set $proxy_proto $http_x_forwarded_proto;
    }
    if ( $http_x_forwarded_port = '443' ) {
        set $proxy_https 'on';
        set $proxy_proto 'https';
    }
    if ( $http_cloudfront_forwarded_proto = 'https' ) {
        set $proxy_https 'on';
        set $proxy_proto $http_cloudfront_forwarded_proto;
    }
    if ( $scheme = 'https' ) {
        set $proxy_https 'on';
    }

    rewrite /wp-admin$ $uri/ permanent;
    #rewrite ^(.*)(index|home|default)\.html? $1 permanent;

    location ~ /wp-content/.*$ {
        try_files $uri @wordpress;

        location ~ /wp-content/(themes|plugins|mu-plugins)/.*\.php$ {
            try_files $uri @wordpress;

            proxy_no_cache     $do_not_cache;
            proxy_cache_bypass $do_not_cache;

            proxy_redirect     off;
            proxy_cache        czone;
            proxy_cache_key    "$proxy_proto://$host$request_uri$mobile";
            proxy_cache_valid  200 0m;
            proxy_pass         http://backend;
        }
    }

    location ~ \.php$ {
        try_files $uri @wordpress;

        proxy_no_cache     $do_not_cache;
        proxy_cache_bypass $do_not_cache;

        proxy_redirect     off;
        proxy_cache        czone;
        proxy_cache_key    "$proxy_proto://$host$request_uri$mobile";
        proxy_cache_valid  200 0m;
        proxy_pass         http://backend;
     }

    location / {
        try_files $uri @wordpress;
    }

    location @wordpress {
        internal;

        proxy_no_cache     $do_not_cache;
        proxy_cache_bypass $do_not_cache;

        proxy_redirect     off;
        proxy_cache        czone;
        proxy_cache_key    "$proxy_proto://$host$request_uri$mobile";
        proxy_cache_valid  200 0m;
        proxy_pass         http://backend;
    }
